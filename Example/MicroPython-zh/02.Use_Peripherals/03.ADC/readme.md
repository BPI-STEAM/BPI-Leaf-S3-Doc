# 使用ADC检测电位器电压

## 外部硬件需求

一个电位器。

![](https://i.imgur.com/mnuHlMR.jpg)

## ESP32-S3的ADC

ESP32-S3芯片内部集成了两个**ADC模数转换器** ，测量范围 0mV-3100mV，分辨率为12bit，即将0mV-3100mV分为2^12=4096级，每一级为一个数字量。

两个ADC模数转换器各有10个测量通道，ADC1为GPIO1 ~ 10,ADC2为GPIO11 ~ 20 。

## 连接方法

GND接GND，VCC接3V3，S输出端接GPIO11管脚，使用的是ADC2的通道1进行测量。

GPIO1~20管脚都可做ADC输入管脚。

## 程序

| 衰减值 | 可测量的输入电压范围 |
| -------- | -------- |
| ADC.ATTN_0DB     | 0 mV ~ 950 mV     |
| ADC.ATTN_2_5DB   | 0 mV ~ 1250 mV     |
| ADC.ATTN_6DB     | 0 mV ~ 1750 mV     |
| ADC.ATTN_11DB     | 0 mV ~ 3100 mV     |

 1. `ADC(*，atten)`初始化一个GPIO管脚的ADC通道，可以选择使用`atten`设定衰减值，它控制芯片可测量的输入电压范围，如果不设置，将为默认值`atten=ADC.ATTN_0DB`或上一次所设定的值。
 2. 可以在初始化一个ADC通道后通过`ADC.atten()`修改衰减值。
 3. `ADC.read()`读取ADC并返回读取结果，ESP32-S3芯片的ADC所返回的是12位精度的数据。
 4. `ADC.read_u16()`读取ADC并将返回16位的数据。
 5. `ADC.read_uv()`根据ADC的特性以`uV`微伏为单位返回校准的输入电压。返回值只有`mV`毫伏分辨率（即，将始终是1000微伏的倍数）。

WiFi功能也使用了ADC2，因此在WiFi处于活动状态时尝试从ADC2的测量通道GPIO11 ~ 20读取模拟值将引发异常。

建议使用`ADC.read_uv()`来读取电压值，它是根据ADC模数转换器的特性经过校准后返回的十进制常数，较比另外两个读取方法更加准确，同时也建议使用时直接经过整除运算：`ADC.read_uv()//1000` 获取`mV`毫伏分辨率的数据。

直接打印输出`ADC.read()`或`ADC.read_u16()`得到的是十进制数值，可用`hex()`函数将数据类型转化为十六进制，例如`hex(ADC.read())`，或用`bin()`函数将数据类型转化为二进制。
